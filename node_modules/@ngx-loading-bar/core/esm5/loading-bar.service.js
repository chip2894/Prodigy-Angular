import { __decorate, __metadata, __param, __read, __spread } from "tslib";
import { Injectable, Optional } from '@angular/core';
import { PLATFORM_ID, Inject } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import { LoadingBarState } from './loading-bar.state';
import { Subject, combineLatest } from 'rxjs';
import { switchMap, map, startWith } from 'rxjs/operators';
import { LOADING_BAR_CONFIG } from './loading-bar.config';
import * as i0 from "@angular/core";
import * as i1 from "./loading-bar.config";
import * as ɵngcc0 from '@angular/core';
var LoadingBarService = /** @class */ (function () {
    function LoadingBarService(platformId, config) {
        var _this = this;
        if (config === void 0) { config = {}; }
        this.platformId = platformId;
        this.config = config;
        this.refs = {};
        this.streams$ = new Subject();
        this.value$ = this.streams$.asObservable().pipe(startWith(null), switchMap(function () { return combineLatest.apply(void 0, __spread(Object.keys(_this.refs).map(function (s) { return _this.refs[s].value$; }))); }), map(function (v) { return Math.max.apply(Math, __spread([0], v)); }));
    }
    Object.defineProperty(LoadingBarService.prototype, "progress$", {
        /** @deprecated use `value$` instead. */
        get: function () {
            return this.value$;
        },
        enumerable: true,
        configurable: true
    });
    /** @deprecated use `useRef` instead. */
    LoadingBarService.prototype.start = function (initialValue) {
        if (initialValue === void 0) { initialValue = 2; }
        this.useRef().start(initialValue);
    };
    /** @deprecated use `useRef` instead. */
    LoadingBarService.prototype.set = function (value) {
        this.useRef().set(value);
    };
    /** @deprecated use `useRef` instead. */
    LoadingBarService.prototype.increment = function (value) {
        this.useRef().increment(value);
    };
    /** @deprecated use `useRef` instead. */
    LoadingBarService.prototype.complete = function () {
        this.useRef().complete();
    };
    /** @deprecated use `useRef` instead. */
    LoadingBarService.prototype.stop = function () {
        this.useRef().stop();
    };
    LoadingBarService.prototype.useRef = function (id) {
        if (id === void 0) { id = 'default'; }
        if (!this.refs[id]) {
            this.refs[id] = new LoadingBarState(this.config);
            this.streams$.next();
            if (!isPlatformBrowser(this.platformId)) {
                this.refs[id].disable();
            }
        }
        return this.refs[id];
    };
    LoadingBarService.ctorParameters = function () { return [
        { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [LOADING_BAR_CONFIG,] }] }
    ]; };
    LoadingBarService.ɵprov = i0.ɵɵdefineInjectable({ factory: function LoadingBarService_Factory() { return new LoadingBarService(i0.ɵɵinject(i0.PLATFORM_ID), i0.ɵɵinject(i1.LOADING_BAR_CONFIG, 8)); }, token: LoadingBarService, providedIn: "root" });
    LoadingBarService = __decorate([ __param(0, Inject(PLATFORM_ID)),
        __param(1, Optional()), __param(1, Inject(LOADING_BAR_CONFIG)),
        __metadata("design:paramtypes", [Object, Object])
    ], LoadingBarService);
LoadingBarService.ɵfac = function LoadingBarService_Factory(t) { return new (t || LoadingBarService)(ɵngcc0.ɵɵinject(PLATFORM_ID), ɵngcc0.ɵɵinject(LOADING_BAR_CONFIG, 8)); };
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LoadingBarService, [{
        type: Injectable,
        args: [{ providedIn: 'root' }]
    }], function () { return [{ type: Object, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }, { type: undefined, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [LOADING_BAR_CONFIG]
            }] }]; }, null); })();
    return LoadingBarService;
}());
export { LoadingBarService };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hZGluZy1iYXIuc2VydmljZS5qcyIsInNvdXJjZXMiOlsiQG5neC1sb2FkaW5nLWJhci9jb3JlL2xvYWRpbmctYmFyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQWtCLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDOUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0QsT0FBTyxFQUFFLGtCQUFrQixFQUFvQixNQUFNLHNCQUFzQixDQUFDO0FBQzVFO0FBRUE7O0FBQUE7QUFDb0IsSUFhbEIsMkJBQytCLFVBQWtCLEVBQ0MsTUFBNkI7QUFDL0UsUUFIQSxpQkFHSTtBQUNOLFFBRm9ELHVCQUFBLEVBQUEsV0FBNkI7QUFDL0UsUUFGK0IsZUFBVSxHQUFWLFVBQVUsQ0FBUTtBQUFDLFFBQ0EsV0FBTSxHQUFOLE1BQU0sQ0FBdUI7QUFBQyxRQWZ4RSxTQUFJLEdBQXNDLEVBQUUsQ0FBQztBQUN2RCxRQUFVLGFBQVEsR0FBRyxJQUFJLE9BQU8sRUFBUSxDQUFDO0FBQ3pDLFFBQVcsV0FBTSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLENBQUMsSUFBSSxDQUNqRCxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQ2YsU0FBUyxDQUFDLGNBQU0sT0FBQSxhQUFhLHdCQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLENBQUMs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b3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBJbmplY3Rpb25Ub2tlbiwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBMQVRGT1JNX0lELCBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IExvYWRpbmdCYXJTdGF0ZSB9IGZyb20gJy4vbG9hZGluZy1iYXIuc3RhdGUnO1xuaW1wb3J0IHsgU3ViamVjdCwgY29tYmluZUxhdGVzdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgc3dpdGNoTWFwLCBtYXAsIHN0YXJ0V2l0aCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IExPQURJTkdfQkFSX0NPTkZJRywgTG9hZGluZ0JhckNvbmZpZyB9IGZyb20gJy4vbG9hZGluZy1iYXIuY29uZmlnJztcblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBMb2FkaW5nQmFyU2VydmljZSB7XG4gIHByaXZhdGUgcmVmczogeyBbaWQ6IHN0cmluZ106IExvYWRpbmdCYXJTdGF0ZSB9ID0ge307XG4gIHByaXZhdGUgc3RyZWFtcyQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICByZWFkb25seSB2YWx1ZSQgPSB0aGlzLnN0cmVhbXMkLmFzT2JzZXJ2YWJsZSgpLnBpcGUoXG4gICAgc3RhcnRXaXRoKG51bGwpLFxuICAgIHN3aXRjaE1hcCgoKSA9PiBjb21iaW5lTGF0ZXN0KC4uLk9iamVjdC5rZXlzKHRoaXMucmVmcykubWFwKChzKSA9PiB0aGlzLnJlZnNbc10udmFsdWUkKSkpLFxuICAgIG1hcCgodikgPT4gTWF0aC5tYXgoMCwgLi4udikpLFxuICApO1xuXG4gIC8qKiBAZGVwcmVjYXRlZCB1c2UgYHZhbHVlJGAgaW5zdGVhZC4gKi9cbiAgZ2V0IHByb2dyZXNzJCgpIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZSQ7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBASW5qZWN0KFBMQVRGT1JNX0lEKSBwcml2YXRlIHBsYXRmb3JtSWQ6IE9iamVjdCxcbiAgICBAT3B0aW9uYWwoKSBASW5qZWN0KExPQURJTkdfQkFSX0NPTkZJRykgcHJpdmF0ZSBjb25maWc6IExvYWRpbmdCYXJDb25maWcgPSB7fSxcbiAgKSB7fVxuXG4gIC8qKiBAZGVwcmVjYXRlZCB1c2UgYHVzZVJlZmAgaW5zdGVhZC4gKi9cbiAgc3RhcnQoaW5pdGlhbFZhbHVlID0gMikge1xuICAgIHRoaXMudXNlUmVmKCkuc3RhcnQoaW5pdGlhbFZhbHVlKTtcbiAgfVxuXG4gIC8qKiBAZGVwcmVjYXRlZCB1c2UgYHVzZVJlZmAgaW5zdGVhZC4gKi9cbiAgc2V0KHZhbHVlOiBudW1iZXIpIHtcbiAgICB0aGlzLnVzZVJlZigpLnNldCh2YWx1ZSk7XG4gIH1cblxuICAvKiogQGRlcHJlY2F0ZWQgdXNlIGB1c2VSZWZgIGluc3RlYWQuICovXG4gIGluY3JlbWVudCh2YWx1ZT86IG51bWJlcikge1xuICAgIHRoaXMudXNlUmVmKCkuaW5jcmVtZW50KHZhbHVlKTtcbiAgfVxuXG4gIC8qKiBAZGVwcmVjYXRlZCB1c2UgYHVzZVJlZmAgaW5zdGVhZC4gKi9cbiAgY29tcGxldGUoKSB7XG4gICAgdGhpcy51c2VSZWYoKS5jb21wbGV0ZSgpO1xuICB9XG5cbiAgLyoqIEBkZXByZWNhdGVkIHVzZSBgdXNlUmVmYCBpbnN0ZWFkLiAqL1xuICBzdG9wKCkge1xuICAgIHRoaXMudXNlUmVmKCkuc3RvcCgpO1xuICB9XG5cbiAgdXNlUmVmKGlkOiBzdHJpbmcgPSAnZGVmYXVsdCcpOiBMb2FkaW5nQmFyU3RhdGUge1xuICAgIGlmICghdGhpcy5yZWZzW2lkXSkge1xuICAgICAgdGhpcy5yZWZzW2lkXSA9IG5ldyBMb2FkaW5nQmFyU3RhdGUodGhpcy5jb25maWcpO1xuICAgICAgdGhpcy5zdHJlYW1zJC5uZXh0KCk7XG5cbiAgICAgIGlmICghaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgICB0aGlzLnJlZnNbaWRdLmRpc2FibGUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5yZWZzW2lkXTtcbiAgfVxufVxuIl19